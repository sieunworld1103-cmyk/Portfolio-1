<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Switch - History_second</title>
  <link rel="stylesheet" href="./css/style_hwan.css">
  <link rel="stylesheet" href="./css/media_hwan.css">
</head>
<body>
  
  
  <section id="history">
    <div class="container">
      <header class="header">
        <h2 class="logo"><a href="index.html"><img src="./img/logo.png" alt=""></a></h2>
        <div class="hamburger">
          <div class="h_bar"></div>
      </div>
      <nav class="nav">
          <ul>
              <li><a href="./index_minju.html">CUSTOM</a></li>
              <li><a href="./index_chan.html">COSMETIC</a></li>
              <li><a href="./index_sieun.html">COLLABORATION</a></li>
              <li><a href="./index_hwan.html">HISTORY</a></li>
              <li><a href="./index_login.html">MY ACCOUNT</a></li>
              <li><a href="./index_cart2.html">CART</a></li>
          </ul>
      </nav>
        <article class="header_article">
          <div class="login"><a href="./index_login.html"><img src="./img/login12.png" alt="login"></a></div>
          <div class="cart"><a href="./index_cart2.html"><img src="./img/cart.png" alt="cart image"></a></div>
        </article>
        <h2 class="history_title">
          <em>WORLD MOVES, UNDER CONTROL BY NON-HUMANS</em>
          <p>인간은 돌아가지만, 그 외에는 살아간다</p>
      </h2>
      </header>
    </div>
  </section>
  <section id="timeline">
    <div class="container">
      <div class="timeline_section">
        <div class="timeline">
          <div class="timeline_progress"></div>
          <div class="timeline_item right timeline_first">
            <div class="content cont1">
              <h3>2000 B.C.E</h3>
              <p class="text1_1">태초에 신은 입김을 불어 움직이는 생명체를 만들어 내었다. <p class="text1_1_1">그들은 자신을 인간이라 불렀고, 그들과 함께 할 움직이는 것들을</p> <p class="text1_1_1_1">만들어 달라 하였다.</p></p>

              <p class="text2_1">그렇게 인간이 신의 품으로 돌아가도 끝까지 그들을 지키는</p ><p class="text2_1_1">움직이는 것들이 생겼고 그들은 아바타라고 불렸다.</p> 
            </div><!--content-->
            <div class="image img1">
              <img src="./img/aa.png" alt="2000 BCE">
            </div><!--image-->
          </div><!--timeline_item-->

          <div class="timeline_item left timeline_second">
            <div class="content cont2">
              <h3 class="cont2_h3">700 B.C</h3>
              <p class="text1_2">모든 인간들이 뭍으로 돌아가고 남아있던 아바타들은 신이 남긴</p><p class="text1_2_1"> 땅을 버릴 수 없어 그들만의 방식으로 땅을 이루어 나갔고</p><p class="text1_2_2"> 언젠가 돌아 올 것이라는 신의 말의 따라 인간을 기다렸다.</p>
              <p class="text2_2">그러나 인간은 수 없이 많은 시간이 지나도록 돌아오지 않았고</p><p class="text2_2_1">  아바타들은 자아를 잃어버렸다.</p>
            </div><!--content-->
            <div class="image img2">
              <img src="./img/bb.png" alt="700 BC">
            </div><!--image-->
          </div><!--timeline_item-->

          <div class="timeline_item right timeline_third">
            <div class="content cont3">
              <h3>600 A.D</h3>
              <p class="text1_3">아바타들은 더이상 움직이는 것들이 아니었다. 인간들이 다시 </p><p class="text1_3_1">신의 입김으로 땅으로 돌아왔을 때에는 그들과 함께했던 아바타들의</p><p class="text1_3_2"> 존재는 전과 같지 않았다. 그들은 유희만을 위한 전유물로 남게 되었다.</p>
              <p class="text2_3">신은 인간이 다시 땅으로 돌아온 그 순간 아바타들의 자아 또한</p><p class="text2_3_1"> 돌아 올 것이라 여겼지만 아바타들의 자아는 이미 신의 손에서</p><p class="text2_3_2">떠나간 후 였다.</p>
            </div><!--content-->
            <div class="image img3">
              <img src="./img/cc.png" alt="600 AD">
            </div><!--image-->
          </div><!--timeline_item-->

          <div class="timeline_item left timeline_fourth">
            <div class="content cont4">
              <h3 class="cont4_h3">1465 A.D</h3>
              <p class="text1_4">시간이 흐르고 인간은 아바타에게 더이상 흥미를 느끼지 못하게 되었다.</p><p class="text1_4_1"> 아바타는 인간에게 유희거리 조차 되지 못하게 되었고</p><p class="text1_4_2"> 인간은 쓰레기와 같아진 아바타를 더이상 찾지 않게 되었다.</p>
              <p class="text2_4">신은 인간과 살아가지 못하는 아바타에게 자아를 되찾아 주려</p><p class="text2_4_1"> 노력하였지만 아바타는 인간과 다르게 </p><p class="text2_4_2">자신들만의 자아를 가진 후 였다.</p>

            </div><!--content-->
            <div class="image img4">
              <img src="./img/dd.png" alt="1465 AD">
            </div><!--image-->
          </div><!--timeline_item-->

          <div class="timeline_item right timeline_fifth">
            <div class="content cont5">
              <h3>PRESENT</h3>
              <p class="text1_5">신의 손에서 벗어난 아바타들은 인간들과 함께 살기 원치 않았고</p><p class="text1_5_1"> 그들은 자신들만의 세상을 만들고자 노력하기 시작했다.</p>
              <p class="text1_5_2">. . .</p>
              <p class="text2_5">먼 미래 아바타들은 자신들만의 세상을 만들었고 그것은</p>
            </div><!--content-->
            <div class="image img5">
              <img src="./img/ee.png" alt="Present">
            </div><!--image-->
          </div><!--timeline_item-->
        </div>
      </div><!--timeline_section-->
    </div>
  </section>
  <section id="sticky_wrapper">
    <section id="final_section">
        <img src="./img/logo.png" alt="logo" />
      </section><!--final_section-->
    </section>

  
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollToPlugin.min.js"></script>
  <script>
    // 사이드메뉴
    $(".hamburger").click(function (e) {
      e.preventDefault();
      $(".nav").toggleClass("open");
    });

    // 타임라인
    const timeline = document.querySelector(".timeline");
    const timelineItems = document.querySelectorAll(".timeline_item");
    const progressLine = document.querySelector(".timeline_progress");
    let currentProgress = 0;
    let dots = [];

    // final section ref + progress-based trigger thresholds
    const finalSection = document.getElementById("final_section");
    const FINAL_TRIGGER_PROGRESS = 99; // show when >= this
    const FINAL_HIDE_PROGRESS = 94;    // hide when <= this on scroll-up
    let finalShown = false;

    // media dot 위치
    function getDotPositions() {
      const width = window.innerWidth;
      if (width <= 320) return [17.5, 34, 49.5, 68, 89];
      if (width <= 480) return [15, 32, 48, 67, 89];
      if (width <= 768) return [11.5, 29, 45.5, 65.5, 89];
      if (width <= 960) return [10.5, 28, 45, 65.5, 89];
      if (width <= 1024) return [9.5, 27.6, 45, 65.7, 89];
      if (width <= 1290) return [9, 27.5, 44.5, 65, 89.3];
      return [8.5, 26.5, 43.5, 64.8, 89];
    }

    // dot 만들기
    function createDots() {
      const count = timelineItems.length;
      const dotPositions = getDotPositions();

      for (let i = 0; i < count; i++) {
        const dot = document.createElement("div");
        dot.classList.add("timeline_dot");

        const topPercent = dotPositions[i];
        dot.style.top = `${topPercent}%`;

        const year = timelineItems[i].querySelector("h3")?.innerText || "";
        dot.setAttribute("data-year", year);

        dot.addEventListener("click", () => {
          gsap.to(window, {
            duration: 1,
            scrollTo: {
              y: timelineItems[i],
              offsetY: window.innerHeight * 0.2,
            },
            ease: "power2.out",
          });
        });

        timeline.appendChild(dot);
        dots.push(dot);
      }
    }

    function resetDots() {
      dots.forEach(dot => dot.remove());
      dots = [];
      createDots();
    }

    createDots();

    // media 변경 시 dot 조정
    window.addEventListener("resize", () => {
      resetDots();
    });

    const observer = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add("show");
        }
      });
    }, { threshold: 0.3 });

    timelineItems.forEach(item => observer.observe(item));

    // 스크롤 따라가는 선 + 진행률 기반 final_section 토글
    function animateLine() {
      const scrollTop = window.scrollY;
      const windowHeight = window.innerHeight;
      const firstDot = dots[0];
      const lastDot = dots[dots.length - 1];

      const start = scrollTop + firstDot.getBoundingClientRect().top;
      const end = scrollTop + lastDot.getBoundingClientRect().top;
      const now = scrollTop + windowHeight * 0.8;

      const target = Math.min(Math.max((now - start) / (end - start), 0), 1) * 100;
      const isGoingUp = target < currentProgress;
      const speed = isGoingUp ? 0.1 : 0.04;

      currentProgress += (target - currentProgress) * speed;

      gsap.to(progressLine, {
        height: `${currentProgress}%`,
        duration: 0.5,
        ease: "power2.out"
      });

      // progress-based final_section toggle
      if (!finalShown && currentProgress >= FINAL_TRIGGER_PROGRESS) {
        finalShown = true;
        finalSection.classList.add('is-active');
      } else if (finalShown && currentProgress <= FINAL_HIDE_PROGRESS) {
        finalShown = false;
        finalSection.classList.remove('is-active');
      }

      requestAnimationFrame(animateLine);
    }

    requestAnimationFrame(animateLine);
  </script>

  
</body>
</html>